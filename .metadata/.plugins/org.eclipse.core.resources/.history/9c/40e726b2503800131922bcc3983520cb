'''
Created on Oct 18, 2013

@author: owner
'''

import os.path
import cherrypy
from cherrypy.lib import static
from os import listdir
from os.path import isfile, join

localDir = os.path.dirname(__file__)
absDir = os.path.join(os.getcwd(), localDir)
fileDir = os.path.join(os.getcwd(), "files")


class server:
    
    def __init__(self):
        print("Init")
    def index(self):
        return "".join(["<html><body>","<h2>Downloads</h2>",self._createHTML(),"<a href='listFiles'>List filesefs</a>","</body></html>"])
    

            

    def download(self):
        path = os.path.join(absDir, "nerdShit.jpg")
        return static.serve_file(path, "application/x-download",
                                 "attachment", os.path.basename(path))
        
    def listFiles(self):
        onlyfiles = [ f for f in listdir(fileDir) if isfile(join(fileDir,f)) ]
        return (onlyfiles)
    
    def _createHTML(self):
        retVal = ""
        for x in self.listFiles():
            retVal = retVal + "<a href='download" +x+ "'>"+x+"</a>"
            
            
        return retVal
        
    listFiles.exposed = True
    download.exposed = True
    index.exposed = True